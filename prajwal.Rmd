---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(shiny)
library(leaflet)
library(RColorBrewer)
library(scales)
library(lattice)
library(dplyr)

# Download the data from https://data.cityofnewyork.us/api/views/3q43-55fe/rows.csv?accessType=DOWNLOAD
# Alternate link: https://data.cityofnewyork.us/Social-Services/Rat-Sightings/3q43-55fe, click Export -> CSV
rat_sightings <- read.csv("/Users/prajwal/Desktop/Columbia/Data Visualization/Group project/gp/data/Rat_Sightings.csv")

rat_sightings$latitude <- rat_sightings$Latitude
rat_sightings$longitude <- rat_sightings$Longitude
rat_sightings$zipcode <- formatC(rat_sightings$`Incident Zip`, width=5, format="d", flag="0")

set.seed(100)
zipdata <- rat_sightings[sample.int(nrow(rat_sightings), 10),]


ui <- fluidPage(
  leafletOutput("map"),
  p(),
  actionButton("recalc", "New points")
)


server <- function(input, output, session) {
  
  # points <- eventReactive(input$recalc, {
  #   cbind(zipdata$latitude, zipdata$longitude)
  # }, ignoreNULL = FALSE)
  # 
  
  points <- eventReactive(input$recalc, {
    zipdata2 <- rat_sightings[sample.int(nrow(rat_sightings), 10),]
    cbind(zipdata2$longitude, zipdata2$latitude)
  }, ignoreNULL = FALSE)

  
  output$map <- renderLeaflet({
    leaflet() %>%
      addProviderTiles(providers$Stamen.TonerLite,
        options = providerTileOptions(noWrap = TRUE)
      ) %>%
      setView(lng = -73.98928, lat = 40.75042, zoom = 10) %>%
      addAwesomeMarkers(data = points())
  })
  
}
shinyApp(ui = ui, server = server)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

